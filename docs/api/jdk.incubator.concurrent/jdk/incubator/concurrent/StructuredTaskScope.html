<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (20) -->
<title>StructuredTaskScope (Java SE 20 &amp; JDK 20)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: module: jdk.incubator.concurrent, package: jdk.incubator.concurrent, class: StructuredTaskScope">
<meta name="generator" content="javadoc/ClassWriterImpl">
<meta name="keywords" content="jdk.incubator.concurrent.StructuredTaskScope class">
<meta name="keywords" content="handleComplete()">
<meta name="keywords" content="fork()">
<meta name="keywords" content="join()">
<meta name="keywords" content="joinUntil()">
<meta name="keywords" content="shutdown()">
<meta name="keywords" content="close()">
<meta name="keywords" content="toString()">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<div class="about-language"><div style="margin-top: 14px;"><strong>Java SE 20 &amp; JDK 20</strong> </div></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="../../../module-summary.html">Module</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/StructuredTaskScope.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../preview-list.html">Preview</a></li>
<li><a href="../../../../new-list.html">New</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../help-doc.html#class">Help</a></li>
</ul>
<ul class="sub-nav-list-small">
<li>
<p>Summary:</p>
<ul>
<li><a href="#nested-class-summary">Nested</a></li>
<li>Field</li>
<li><a href="#constructor-summary">Constr</a></li>
<li><a href="#method-summary">Method</a></li>
</ul>
</li>
<li>
<p>Detail:</p>
<ul>
<li>Field</li>
<li><a href="#constructor-detail">Constr</a></li>
<li><a href="#method-detail">Method</a></li>
</ul>
</li>
</ul>
</div>
<div class="sub-nav">
<div id="navbar-sub-list">
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li><a href="#nested-class-summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><a href="../../../../search.html">SEARCH</a>
<input type="text" id="search-input" disabled placeholder="Search">
<input type="reset" id="reset-button" disabled value="reset">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="module-label-in-type">Module</span>&nbsp;<a href="../../../module-summary.html">jdk.incubator.concurrent</a></div>
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">jdk.incubator.concurrent</a></div>
<h1 title="Class StructuredTaskScope" class="title">Class StructuredTaskScope&lt;T&gt;</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="../../../../java.base/java/lang/Object.html" title="class in java.lang">java.lang.Object</a>
<div class="inheritance">jdk.incubator.concurrent.StructuredTaskScope&lt;T&gt;</div>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>Type Parameters:</dt>
<dd><code>T</code> - the result type of tasks executed in the scope</dd>
</dl>
<dl class="notes">
<dt>All Implemented Interfaces:</dt>
<dd><code><a href="../../../../java.base/java/lang/AutoCloseable.html" title="interface in java.lang">AutoCloseable</a></code></dd>
</dl>
<dl class="notes">
<dt>Direct Known Subclasses:</dt>
<dd><code><a href="StructuredTaskScope.ShutdownOnFailure.html" title="class in jdk.incubator.concurrent">StructuredTaskScope.ShutdownOnFailure</a></code>, <code><a href="StructuredTaskScope.ShutdownOnSuccess.html" title="class in jdk.incubator.concurrent">StructuredTaskScope.ShutdownOnSuccess</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">StructuredTaskScope&lt;T&gt;</span>
<span class="extends-implements">extends <a href="../../../../java.base/java/lang/Object.html" title="class in java.lang">Object</a>
implements <a href="../../../../java.base/java/lang/AutoCloseable.html" title="interface in java.lang">AutoCloseable</a></span></div>
<div class="block">A basic API for <em>structured concurrency</em>. <code>StructuredTaskScope</code> supports
 cases where a task splits into several concurrent subtasks, to be executed in their
 own threads, and where the subtasks must complete before the main task continues. A
 <code>StructuredTaskScope</code> can be used to ensure that the lifetime of a concurrent
 operation is confined by a <em>syntax block</em>, just like that of a sequential
 operation in structured programming.

 <h2 id="basic-usage-heading">Basic usage</h2>

 A <code>StructuredTaskScope</code> is created with one of its public constructors. It defines
 the <a href="#fork(java.util.concurrent.Callable)"><code>fork</code></a> method to start a thread to execute a task, the <a href="#join()"><code>join</code></a> method to wait for all threads to finish, and the <a href="#close()"><code>close</code></a>
 method to close the task scope. The API is intended to be used with the <code>
 try-with-resources</code> construct. The intention is that code in the <em>block</em> uses
 the <code>fork</code> method to fork threads to execute the subtasks, wait for the threads
 to finish with the <code>join</code> method, and then <em>process the results</em>.
 Processing of results may include handling or re-throwing of exceptions.
 
<div class="snippet-container"><button class="copy snippet-copy" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="../../../../copy.svg" alt="Copy"></button>
<pre class="snippet"><code class="language-java">    try (var scope = new StructuredTaskScope&lt;Object&gt;()) {

        Future&lt;Integer&gt; future1 = scope.<span class="bold">fork</span>(task1);
        Future&lt;String&gt; future2 = scope.<span class="bold">fork</span>(task2);

        scope.<span class="bold">join</span>();

        ... process results/exceptions ...

    } // <span class="bold">close</span>
</code></pre>
</div>

 To ensure correct usage, the <code>join</code> and <code>close</code> methods may only be invoked
 by the <em>owner</em> (the thread that opened/created the task scope}, and the
 <code>close</code> method throws an exception after closing if the owner did not invoke the
 <code>join</code> method after forking.

 <p> <code>StructuredTaskScope</code> defines the <a href="#shutdown()"><code>shutdown</code></a> method to shut
 down a task scope without closing it. Shutdown is useful for cases where a subtask
 completes with a result (or exception) and the results of other unfinished subtasks are
 no longer needed. If a subtask invokes <code>shutdown</code> while the owner is waiting in
 the <code>join</code> method then it will cause <code>join</code> to wakeup, all unfinished
 threads to be <a href="../../../../java.base/java/lang/Thread.html#interrupt()">interrupted</a> and prevents new threads
 from starting in the task scope.

 <h2 id="subclasses-with-policies-for-common-cases-heading">Subclasses with policies for common cases</h2>

 Two subclasses of <code>StructuredTaskScope</code> are defined to implement policy for
 common cases:
 <ol>
   <li> <a href="StructuredTaskScope.ShutdownOnSuccess.html" title="class in jdk.incubator.concurrent"><code>ShutdownOnSuccess</code></a> captures the first result and
   shuts down the task scope to interrupt unfinished threads and wakeup the owner. This
   class is intended for cases where the result of any subtask will do ("invoke any")
   and where there is no need to wait for results of other unfinished tasks. It defines
   methods to get the first result or throw an exception if all subtasks fail.
   <li> <a href="StructuredTaskScope.ShutdownOnFailure.html" title="class in jdk.incubator.concurrent"><code>ShutdownOnFailure</code></a> captures the first exception and
   shuts down the task scope. This class is intended for cases where the results of all
   subtasks are required ("invoke all"); if any subtask fails then the results of other
   unfinished subtasks are no longer needed. If defines methods to throw an exception if
   any of the subtasks fail.
 </ol>

 <p> The following are two examples that use the two classes. In both cases, a pair of
 subtasks are forked to fetch resources from two URL locations "left" and "right". The
 first example creates a ShutdownOnSuccess object to capture the result of the first
 subtask to complete normally, cancelling the other by way of shutting down the task
 scope. The main task waits in <code>join</code> until either subtask completes with a result
 or both subtasks fail. It invokes <a href="StructuredTaskScope.ShutdownOnSuccess.html#result(java.util.function.Function)"><code>result(Function)</code></a> method to get the captured result. If both subtasks fail then this
 method throws a <code>WebApplicationException</code> with the exception from one of the
 subtasks as the cause.
 
<div class="snippet-container"><button class="copy snippet-copy" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="../../../../copy.svg" alt="Copy"></button>
<pre class="snippet"><code class="language-java">    try (var scope = new StructuredTaskScope.ShutdownOnSuccess&lt;String&gt;()) {

        scope.fork(() -&gt; fetch(left));
        scope.fork(() -&gt; fetch(right));

        scope.join();

        String result = scope.<a href="StructuredTaskScope.ShutdownOnSuccess.html#result()"><code>result</code></a>(e -&gt; new WebApplicationException(e));

        ...
    }
</code></pre>
</div>

 The second example creates a ShutdownOnFailure object to capture the exception of the
 first subtask to fail, cancelling the other by way of shutting down the task scope. The
 main task waits in <a href="#joinUntil(java.time.Instant)"><code>joinUntil(Instant)</code></a> until both subtasks complete with a
 result, either fails, or a deadline is reached. It invokes <a href="StructuredTaskScope.ShutdownOnFailure.html#throwIfFailed(java.util.function.Function)"><code>throwIfFailed(Function)</code></a> to throw an exception
 when either subtask fails. This method is a no-op if no subtasks fail. The main task
 uses <code>Future</code>'s <a href="../../../../java.base/java/util/concurrent/Future.html#resultNow()"><code>resultNow()</code></a> method to retrieve the
 results.

 
<div class="snippet-container"><button class="copy snippet-copy" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="../../../../copy.svg" alt="Copy"></button>
<pre class="snippet"><code class="language-java">   Instant deadline = ...

   try (var scope = new StructuredTaskScope.ShutdownOnFailure()) {

        Future&lt;String&gt; future1 = scope.fork(() -&gt; query(left));
        Future&lt;String&gt; future2 = scope.fork(() -&gt; query(right));

        scope.joinUntil(deadline);

        scope.<a href="StructuredTaskScope.ShutdownOnFailure.html#throwIfFailed()"><code>throwIfFailed</code></a>(e -&gt; new WebApplicationException(e));

        // both subtasks completed successfully
        String result = Stream.of(future1, future2)
                .map(<a href="../../../../java.base/java/util/concurrent/Future.html#resultNow()"><code>Future::resultNow</code></a>)
                .collect(Collectors.joining(", ", "{ ", " }"));

        ...
    }
</code></pre>
</div>


 <h2 id="extending-structuredtaskscope-heading">Extending StructuredTaskScope</h2>

 <code>StructuredTaskScope</code> can be extended, and the <a href="#handleComplete(java.util.concurrent.Future)"><code>handleComplete</code></a> overridden, to implement policies other than those implemented by
 <code>ShutdownOnSuccess</code> and <code>ShutdownOnFailure</code>. The method may be overridden
 to, for example, collect the results of subtasks that complete with a result and ignore
 subtasks that fail. It may collect exceptions when subtasks fail. It may invoke the
 <a href="#shutdown()"><code>shutdown</code></a> method to shut down and cause <a href="#join()"><code>join</code></a> to
 wakeup when some condition arises.

 <p> A subclass will typically define methods to make available results, state, or other
 outcome to code that executes after the <code>join</code> method. A subclass that collects
 results and ignores subtasks that fail may define a method that returns a collection of
 results. A subclass that implements a policy to shut down when a subtask fails may
 define a method to retrieve the exception of the first subtask to fail.

 <p> The following is an example of a <code>StructuredTaskScope</code> implementation that
 collects the results of subtasks that complete successfully. It defines the method
 <b><code>results()</code></b> to be used by the main task to retrieve the results.

 
<div class="snippet-container"><button class="copy snippet-copy" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="../../../../copy.svg" alt="Copy"></button>
<pre class="snippet"><code class="language-java">   class MyScope&lt;T&gt; extends StructuredTaskScope&lt;T&gt; {
       private final Queue&lt;T&gt; results = new ConcurrentLinkedQueue&lt;&gt;();

       MyScope() {
           super(null, Thread.ofVirtual().factory());
       }

       @Override
       protected void <a href="#handleComplete(java.util.concurrent.Future)"><code>handleComplete</code></a>(Future&lt;T&gt; future) {
           if (future.state() == Future.State.SUCCESS) {
               T result = future.resultNow();
               results.add(result);
           }
       }

       // Returns a stream of results from the subtasks that completed successfully
       public Stream&lt;T&gt; <span class="bold">results</span>() {
           return results.stream();
       }
   }
</code></pre>
</div>


 <h2><a id="TreeStructure">Tree structure</a></h2>

 Task scopes form a tree where parent-child relations are established implicitly when
 opening a new task scope:
 <ul>
   <li> A parent-child relation is established when a thread started in a task scope
   opens its own task scope. A thread started in task scope "A" that opens task scope
   "B" establishes a parent-child relation where task scope "A" is the parent of task
   scope "B".
   <li> A parent-child relation is established with nesting. If a thread opens task
   scope "B", then opens task scope "C" (before it closes "B"), then the enclosing task
   scope "B" is the parent of the nested task scope "C".
 </ul>

 The <i>descendants</i> of a task scope are the child task scopes that it is a parent
 of, plus the descendants of the child task scopes, recursively.

 <p> The tree structure supports:
 <ul>
   <li> Inheritance of <a href="ScopedValue.html" title="class in jdk.incubator.concurrent">scoped values</a> across threads.
   <li> Confinement checks. The phrase "threads contained in the task scope" in method
   descriptions means threads started in the task scope or descendant scopes.
 </ul>

 <p> The following example demonstrates the inheritance of a scoped value. A scoped
 value <code>USERNAME</code> is bound to the value "<code>duke</code>". A <code>StructuredTaskScope</code>
 is created and its <code>fork</code> method invoked to start a thread to execute <code>
 childTask</code>. The thread inherits the scoped value <em>bindings</em> captured when
 creating the task scope. The code in <code>childTask</code> uses the value of the scoped
 value and so reads the value "<code>duke</code>".
 
<div class="snippet-container"><button class="copy snippet-copy" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="../../../../copy.svg" alt="Copy"></button>
<pre class="snippet"><code class="language-java">    private static final ScopedValue&lt;String&gt; USERNAME = ScopedValue.newInstance();

    ScopedValue.<a href="ScopedValue.html#where(jdk.incubator.concurrent.ScopedValue,T,java.lang.Runnable)"><code>where</code></a>(USERNAME, "duke", () -&gt; {
        try (var scope = new StructuredTaskScope&lt;String&gt;()) {

            scope.<span class="bold">fork</span>(() -&gt; childTask());
            ...
         }
    });

    ...

    String childTask() {
        String name = USERNAME.<a href="ScopedValue.html#get()"><code>get</code></a>();   // "duke"
        ...
    }
</code></pre>
</div>


 <p> <code>StructuredTaskScope</code> does not define APIs that exposes the tree structure
 at this time.

 <p> Unless otherwise specified, passing a <code>null</code> argument to a constructor
 or method in this class will cause a <a href="../../../../java.base/java/lang/NullPointerException.html" title="class in java.lang"><code>NullPointerException</code></a> to be thrown.

 <h2 id="memory-consistency-effects-heading">Memory consistency effects</h2>

 <p> Actions in the owner thread of, or a thread contained in, the task scope prior to
 <a href="#fork(java.util.concurrent.Callable)">forking</a> of a <code>Callable</code> task
 <a href="../../../../java.base/java/util/concurrent/package-summary.html#MemoryVisibility">
 <i>happen-before</i></a> any actions taken by that task, which in turn <i>happen-before</i>
 the task result is retrieved via its <code>Future</code>, or <i>happen-before</i> any actions
 taken in a thread after <a href="#join()">joining</a> of the task scope.</div>
<dl class="notes"><dt>See <i>Java Language Specification</i>:</dt>
<dd>
<a href="https://docs.oracle.com/javase/specs/jls/se20/html/jls-17.html#jls-17.4.5">17.4.5 Happens-before Order</a><br></dd>
<dt>Since:</dt>
<dd>19</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li>
<section class="nested-class-summary" id="nested-class-summary">
<h2>Nested Class Summary</h2>
<div class="caption"><span>Nested Classes</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>static final class&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="StructuredTaskScope.ShutdownOnFailure.html" class="type-name-link" title="class in jdk.incubator.concurrent">StructuredTaskScope.ShutdownOnFailure</a></code></div>
<div class="col-last even-row-color">
<div class="block">A <code>StructuredTaskScope</code> that captures the exception of the first subtask to
 complete abnormally.</div>
</div>
<div class="col-first odd-row-color"><code>static final class&nbsp;</code></div>
<div class="col-second odd-row-color"><code><a href="StructuredTaskScope.ShutdownOnSuccess.html" class="type-name-link" title="class in jdk.incubator.concurrent">StructuredTaskScope.ShutdownOnSuccess</a>&lt;<a href="StructuredTaskScope.ShutdownOnSuccess.html" title="type parameter in StructuredTaskScope.ShutdownOnSuccess">T</a>&gt;</code></div>
<div class="col-last odd-row-color">
<div class="block">A <code>StructuredTaskScope</code> that captures the result of the first subtask to
 complete successfully.</div>
</div>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">StructuredTaskScope</a>()</code></div>
<div class="col-last even-row-color">
<div class="block">Creates an unnamed structured task scope that creates virtual threads.</div>
</div>
<div class="col-constructor-name odd-row-color"><code><a href="#%3Cinit%3E(java.lang.String,java.util.concurrent.ThreadFactory)" class="member-name-link">StructuredTaskScope</a><wbr>(<a href="../../../../java.base/java/lang/String.html" title="class in java.lang">String</a>&nbsp;name,
 <a href="../../../../java.base/java/util/concurrent/ThreadFactory.html" title="interface in java.util.concurrent">ThreadFactory</a>&nbsp;factory)</code></div>
<div class="col-last odd-row-color">
<div class="block">Creates a structured task scope with the given name and thread factory.</div>
</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#close()" class="member-name-link">close</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Closes this task scope.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>&lt;U extends <a href="StructuredTaskScope.html" title="type parameter in StructuredTaskScope">T</a>&gt;<br><a href="../../../../java.base/java/util/concurrent/Future.html" title="interface in java.util.concurrent">Future</a>&lt;U&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#fork(java.util.concurrent.Callable)" class="member-name-link">fork</a><wbr>(<a href="../../../../java.base/java/util/concurrent/Callable.html" title="interface in java.util.concurrent">Callable</a>&lt;? extends U&gt;&nbsp;task)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Starts a new thread to run the given task.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#handleComplete(java.util.concurrent.Future)" class="member-name-link">handleComplete</a><wbr>(<a href="../../../../java.base/java/util/concurrent/Future.html" title="interface in java.util.concurrent">Future</a>&lt;<a href="StructuredTaskScope.html" title="type parameter in StructuredTaskScope">T</a>&gt;&nbsp;future)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Invoked when a task completes before the scope is shut down.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="StructuredTaskScope.html" title="class in jdk.incubator.concurrent">StructuredTaskScope</a>&lt;<a href="StructuredTaskScope.html" title="type parameter in StructuredTaskScope">T</a>&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#join()" class="member-name-link">join</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Wait for all threads to finish or the task scope to shut down.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="StructuredTaskScope.html" title="class in jdk.incubator.concurrent">StructuredTaskScope</a>&lt;<a href="StructuredTaskScope.html" title="type parameter in StructuredTaskScope">T</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#joinUntil(java.time.Instant)" class="member-name-link">joinUntil</a><wbr>(<a href="../../../../java.base/java/time/Instant.html" title="class in java.time">Instant</a>&nbsp;deadline)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Wait for all threads to finish or the task scope to shut down, up to the given
 deadline.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#shutdown()" class="member-name-link">shutdown</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Shut down the task scope without closing it.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods declared in class&nbsp;java.lang.<a href="../../../../java.base/java/lang/Object.html" title="class in java.lang">Object</a></h3>
<code><a href="../../../../java.base/java/lang/Object.html#clone()">clone</a>, <a href="../../../../java.base/java/lang/Object.html#equals(java.lang.Object)">equals</a>, <a href="../../../../java.base/java/lang/Object.html#finalize()">finalize</a>, <a href="../../../../java.base/java/lang/Object.html#getClass()">getClass</a>, <a href="../../../../java.base/java/lang/Object.html#hashCode()">hashCode</a>, <a href="../../../../java.base/java/lang/Object.html#notify()">notify</a>, <a href="../../../../java.base/java/lang/Object.html#notifyAll()">notifyAll</a>, <a href="../../../../java.base/java/lang/Object.html#toString()">toString</a>, <a href="../../../../java.base/java/lang/Object.html#wait()">wait</a>, <a href="../../../../java.base/java/lang/Object.html#wait(long)">wait</a>, <a href="../../../../java.base/java/lang/Object.html#wait(long,int)">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;(java.lang.String,java.util.concurrent.ThreadFactory)">
<h3>StructuredTaskScope</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">StructuredTaskScope</span><wbr><span class="parameters">(<a href="../../../../java.base/java/lang/String.html" title="class in java.lang">String</a>&nbsp;name,
 <a href="../../../../java.base/java/util/concurrent/ThreadFactory.html" title="interface in java.util.concurrent">ThreadFactory</a>&nbsp;factory)</span></div>
<div class="block">Creates a structured task scope with the given name and thread factory. The task
 scope is optionally named for the purposes of monitoring and management. The thread
 factory is used to <a href="../../../../java.base/java/util/concurrent/ThreadFactory.html#newThread(java.lang.Runnable)"><code>create</code></a> threads when
 tasks are <a href="#fork(java.util.concurrent.Callable)">forked</a>. The task scope is owned by the
 current thread.

 <p> This method captures the current thread's <a href="ScopedValue.html" title="class in jdk.incubator.concurrent">scoped value</a>
 bindings for inheritance by threads created in the task scope. The
 <a href="#TreeStructure">Tree Structure</a> section in the class description
 details how parent-child relations are established implicitly for the purpose of
 inheritance of scoped value bindings.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>name</code> - the name of the task scope, can be null</dd>
<dd><code>factory</code> - the thread factory</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>StructuredTaskScope</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">StructuredTaskScope</span>()</div>
<div class="block">Creates an unnamed structured task scope that creates virtual threads. The task
 scope is owned by the current thread.

 <p> This constructor is equivalent to invoking the 2-arg constructor with a name
 of <code>null</code> and a thread factory that creates virtual threads.</div>
<dl class="notes">
<dt>Throws:</dt>
<dd><code><a href="../../../../java.base/java/lang/UnsupportedOperationException.html" title="class in java.lang">UnsupportedOperationException</a></code> - if preview features are not enabled</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="handleComplete(java.util.concurrent.Future)">
<h3>handleComplete</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">handleComplete</span><wbr><span class="parameters">(<a href="../../../../java.base/java/util/concurrent/Future.html" title="interface in java.util.concurrent">Future</a>&lt;<a href="StructuredTaskScope.html" title="type parameter in StructuredTaskScope">T</a>&gt;&nbsp;future)</span></div>
<div class="block">Invoked when a task completes before the scope is shut down.

 <p> The <code>handleComplete</code> method should be thread safe. It may be invoked by
 several threads concurrently.</div>
<dl class="notes">
<dt>Implementation Requirements:</dt>
<dd>The default implementation does nothing.</dd>
<dt>Parameters:</dt>
<dd><code>future</code> - the completed task</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="fork(java.util.concurrent.Callable)">
<h3>fork</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="type-parameters">&lt;U extends <a href="StructuredTaskScope.html" title="type parameter in StructuredTaskScope">T</a>&gt;</span>&nbsp;<span class="return-type"><a href="../../../../java.base/java/util/concurrent/Future.html" title="interface in java.util.concurrent">Future</a>&lt;U&gt;</span>&nbsp;<span class="element-name">fork</span><wbr><span class="parameters">(<a href="../../../../java.base/java/util/concurrent/Callable.html" title="interface in java.util.concurrent">Callable</a>&lt;? extends U&gt;&nbsp;task)</span></div>
<div class="block">Starts a new thread to run the given task.

 <p> The new thread is created with the task scope's <a href="../../../../java.base/java/util/concurrent/ThreadFactory.html" title="interface in java.util.concurrent"><code>ThreadFactory</code></a>. It
 inherits the current thread's <a href="ScopedValue.html" title="class in jdk.incubator.concurrent">scoped value</a> bindings. The
 bindings must match the bindings captured when the task scope was created.

 <p> If the task completes before the task scope is <a href="#shutdown()"><code>shutdown</code></a>
 then the <a href="#handleComplete(java.util.concurrent.Future)"><code>handleComplete</code></a> method is invoked to
 consume the completed task. The <code>handleComplete</code> method is run when the task
 completes with a result or exception. If the <code>Future</code>'s <a href="../../../../java.base/java/util/concurrent/Future.html#cancel(boolean)"><code>cancel</code></a> method is used to cancel a task before the task scope
 is shut down, then the <code>handleComplete</code> method is run by the thread that
 invokes <code>cancel</code>. If the task scope shuts down at or around the same time
 that the task completes or is cancelled then the <code>handleComplete</code> method may
 or may not be invoked.

 <p> If this task scope is <a href="#shutdown()">shutdown</a> (or in the process
 of shutting down) then <code>fork</code> returns a <code>Future</code> representing a <a href="../../../../java.base/java/util/concurrent/Future.State.html#CANCELLED"><code>cancelled</code></a> task that was not run.

 <p> This method may only be invoked by the task scope owner or threads contained
 in the task scope. The <a href="../../../../java.base/java/util/concurrent/Future.html#cancel(boolean)"><code>cancel</code></a> method of the returned
 <code>Future</code> object is also restricted to the task scope owner or threads contained
 in the task scope. The <code>cancel</code> method throws <a href="../../../../java.base/java/lang/WrongThreadException.html" title="class in java.lang"><code>WrongThreadException</code></a>
 if invoked from another thread. All other methods on the returned <code>Future</code>
 object, such as <a href="../../../../java.base/java/util/concurrent/Future.html#get()"><code>get</code></a>, are not restricted.</div>
<dl class="notes">
<dt>Type Parameters:</dt>
<dd><code>U</code> - the result type</dd>
<dt>Parameters:</dt>
<dd><code>task</code> - the task to run</dd>
<dt>Returns:</dt>
<dd>a future</dd>
<dt>Throws:</dt>
<dd><code><a href="../../../../java.base/java/lang/IllegalStateException.html" title="class in java.lang">IllegalStateException</a></code> - if this task scope is closed</dd>
<dd><code><a href="../../../../java.base/java/lang/WrongThreadException.html" title="class in java.lang">WrongThreadException</a></code> - if the current thread is not the owner or a thread
 contained in the task scope</dd>
<dd><code><a href="StructureViolationException.html" title="class in jdk.incubator.concurrent">StructureViolationException</a></code> - if the current scoped value bindings are not
 the same as when the task scope was created</dd>
<dd><code><a href="../../../../java.base/java/util/concurrent/RejectedExecutionException.html" title="class in java.util.concurrent">RejectedExecutionException</a></code> - if the thread factory rejected creating a
 thread to run the task</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="join()">
<h3>join</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="StructuredTaskScope.html" title="class in jdk.incubator.concurrent">StructuredTaskScope</a>&lt;<a href="StructuredTaskScope.html" title="type parameter in StructuredTaskScope">T</a>&gt;</span>&nbsp;<span class="element-name">join</span>()
                            throws <span class="exceptions"><a href="../../../../java.base/java/lang/InterruptedException.html" title="class in java.lang">InterruptedException</a></span></div>
<div class="block">Wait for all threads to finish or the task scope to shut down. This method waits
 until all threads started in the task scope finish execution (of both task and
 <a href="#handleComplete(java.util.concurrent.Future)"><code>handleComplete</code></a> method), the <a href="#shutdown()"><code>shutdown</code></a> method is invoked to shut down the task scope, or the current thread
 is <a href="../../../../java.base/java/lang/Thread.html#interrupt()">interrupted</a>.

 <p> This method may only be invoked by the task scope owner.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>this task scope</dd>
<dt>Throws:</dt>
<dd><code><a href="../../../../java.base/java/lang/IllegalStateException.html" title="class in java.lang">IllegalStateException</a></code> - if this task scope is closed</dd>
<dd><code><a href="../../../../java.base/java/lang/WrongThreadException.html" title="class in java.lang">WrongThreadException</a></code> - if the current thread is not the owner</dd>
<dd><code><a href="../../../../java.base/java/lang/InterruptedException.html" title="class in java.lang">InterruptedException</a></code> - if interrupted while waiting</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="joinUntil(java.time.Instant)">
<h3>joinUntil</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="StructuredTaskScope.html" title="class in jdk.incubator.concurrent">StructuredTaskScope</a>&lt;<a href="StructuredTaskScope.html" title="type parameter in StructuredTaskScope">T</a>&gt;</span>&nbsp;<span class="element-name">joinUntil</span><wbr><span class="parameters">(<a href="../../../../java.base/java/time/Instant.html" title="class in java.time">Instant</a>&nbsp;deadline)</span>
                                 throws <span class="exceptions"><a href="../../../../java.base/java/lang/InterruptedException.html" title="class in java.lang">InterruptedException</a>,
<a href="../../../../java.base/java/util/concurrent/TimeoutException.html" title="class in java.util.concurrent">TimeoutException</a></span></div>
<div class="block">Wait for all threads to finish or the task scope to shut down, up to the given
 deadline. This method waits until all threads started in the task scope finish
 execution (of both task and <a href="#handleComplete(java.util.concurrent.Future)"><code>handleComplete</code></a> method),
 the <a href="#shutdown()"><code>shutdown</code></a> method is invoked to shut down the task scope,
 the current thread is <a href="../../../../java.base/java/lang/Thread.html#interrupt()">interrupted</a>, or the deadline
 is reached.

 <p> This method may only be invoked by the task scope owner.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>deadline</code> - the deadline</dd>
<dt>Returns:</dt>
<dd>this task scope</dd>
<dt>Throws:</dt>
<dd><code><a href="../../../../java.base/java/lang/IllegalStateException.html" title="class in java.lang">IllegalStateException</a></code> - if this task scope is closed</dd>
<dd><code><a href="../../../../java.base/java/lang/WrongThreadException.html" title="class in java.lang">WrongThreadException</a></code> - if the current thread is not the owner</dd>
<dd><code><a href="../../../../java.base/java/lang/InterruptedException.html" title="class in java.lang">InterruptedException</a></code> - if interrupted while waiting</dd>
<dd><code><a href="../../../../java.base/java/util/concurrent/TimeoutException.html" title="class in java.util.concurrent">TimeoutException</a></code> - if the deadline is reached while waiting</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="shutdown()">
<h3>shutdown</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">shutdown</span>()</div>
<div class="block">Shut down the task scope without closing it. Shutting down a task scope prevents
 new threads from starting, interrupts all unfinished threads, and causes the
 <a href="#join()"><code>join</code></a> method to wakeup. Shutdown is useful for cases where the
 results of unfinished subtasks are no longer needed.

 <p> More specifically, this method:
 <ul>
 <li> <a href="../../../../java.base/java/util/concurrent/Future.html#cancel(boolean)">Cancels</a> the tasks that have threads
 <a href="../../../../java.base/java/util/concurrent/Future.html#get()">waiting</a> on a result so that the waiting threads wakeup.
 <li> <a href="../../../../java.base/java/lang/Thread.html#interrupt()">Interrupts</a> all unfinished threads in the
 task scope (except the current thread).
 <li> Wakes up the owner if it is waiting in <a href="#join()"><code>join()</code></a> or <a href="#joinUntil(java.time.Instant)"><code>joinUntil(Instant)</code></a>. If the owner is not waiting then its next call to <code>
 join</code> or <code>joinUntil</code> will return immediately.
 </ul>

 <p> When this method completes then the <code>Future</code> objects for all tasks will
 be <a href="../../../../java.base/java/util/concurrent/Future.html#isDone()">done</a>, normally or abnormally. There may still
 be threads that have not finished because they are executing code that did not
 respond (or respond promptly) to thread interrupt. This method does not wait
 for these threads. When the owner invokes the <a href="#close()"><code>close</code></a> method
 to close the task scope then it will wait for the remaining threads to finish.

 <p> This method may only be invoked by the task scope owner or threads contained
 in the task scope.</div>
<dl class="notes">
<dt>Throws:</dt>
<dd><code><a href="../../../../java.base/java/lang/IllegalStateException.html" title="class in java.lang">IllegalStateException</a></code> - if this task scope is closed</dd>
<dd><code><a href="../../../../java.base/java/lang/WrongThreadException.html" title="class in java.lang">WrongThreadException</a></code> - if the current thread is not the owner or
 a thread contained in the task scope</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="close()">
<h3>close</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">close</span>()</div>
<div class="block">Closes this task scope.

 <p> This method first shuts down the task scope (as if by invoking the <a href="#shutdown()"><code>shutdown</code></a> method). It then waits for the threads executing any
 unfinished tasks to finish. If interrupted then this method will continue to
 wait for the threads to finish before completing with the interrupt status set.

 <p> This method may only be invoked by the task scope owner. If the task scope
 is already closed then the owner invoking this method has no effect.

 <p> A <code>StructuredTaskScope</code> is intended to be used in a <em>structured
 manner</em>. If this method is called to close a task scope before nested task
 scopes are closed then it closes the underlying construct of each nested task scope
 (in the reverse order that they were created in), closes this task scope, and then
 throws <a href="StructureViolationException.html" title="class in jdk.incubator.concurrent"><code>StructureViolationException</code></a>.

 Similarly, if this method is called to close a task scope while executing with
 <a href="ScopedValue.html" title="class in jdk.incubator.concurrent">scoped value</a> bindings, and the task scope was created
 before the scoped values were bound, then <code>StructureViolationException</code> is
 thrown after closing the task scope.

 If a thread terminates without first closing task scopes that it owns then
 termination will cause the underlying construct of each of its open tasks scopes to
 be closed. Closing is performed in the reverse order that the task scopes were
 created in. Thread termination may therefore be delayed when the owner has to wait
 for threads forked in these task scopes to finish.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../../../../java.base/java/lang/AutoCloseable.html#close()">close</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../java.base/java/lang/AutoCloseable.html" title="interface in java.lang">AutoCloseable</a></code></dd>
<dt>Throws:</dt>
<dd><code><a href="../../../../java.base/java/lang/IllegalStateException.html" title="class in java.lang">IllegalStateException</a></code> - thrown after closing the task scope if the owner
 did not invoke join after forking</dd>
<dd><code><a href="../../../../java.base/java/lang/WrongThreadException.html" title="class in java.lang">WrongThreadException</a></code> - if the current thread is not the owner</dd>
<dd><code><a href="StructureViolationException.html" title="class in jdk.incubator.concurrent">StructureViolationException</a></code> - if a structure violation was detected</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small><a href="https://bugreport.java.com/bugreport/">Report a bug or suggest an enhancement</a><br> For further API reference and developer documentation see the <a href="https://docs.oracle.com/pls/topic/lookup?ctx=javase20&amp;id=homepage" target="_blank">Java SE Documentation</a>, which contains more detailed, developer-targeted descriptions with conceptual overviews, definitions of terms, workarounds, and working code examples. <a href="https://docs.oracle.com/en/java/javase/index.html">Other versions.</a><br> Java is a trademark or registered trademark of Oracle and/or its affiliates in the US and other countries.<br> <a href="../../../../../legal/copyright.html">Copyright</a> &copy; 1993, 2023, Oracle and/or its affiliates, 500 Oracle Parkway, Redwood Shores, CA 94065 USA.<br>All rights reserved. Use is subject to <a href="https://www.oracle.com/java/javase/terms/license/java20speclicense.html">license terms</a> and the <a href="https://www.oracle.com/technetwork/java/redist-137594.html">documentation redistribution policy</a>. <!-- Version 20+36-2344 --></small></p>
</footer>
</div>
</div>
</body>
</html>
